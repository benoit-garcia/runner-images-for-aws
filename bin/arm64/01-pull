#!/bin/bash
set -eo pipefail

RELEASE_DIR="$1"
RELEASE_ARCH="arm64"

if [ -z "$RELEASE_DIR" ]; then
  echo "Usage: $0 <RELEASE_DIR>"
  exit 1
fi

echo "Cloning $RELEASE_DIR..."
mkdir -p releases
rm -rf "$RELEASE_DIR"
mkdir -p "$(dirname "$RELEASE_DIR")"

RELEASE_DIST=$(basename $(dirname "$RELEASE_DIR"))
RELEASE_DATE=$(basename "$RELEASE_DIR" | cut -d '-' -f 1)

git clone --depth 1 --branch "$RELEASE_DIST/$RELEASE_DATE" https://github.com/actions/runner-images.git "$RELEASE_DIR"
for useless_dir in .git .github docs images.CI images/macos images/windows; do
  rm -rf "${RELEASE_DIR:?}/${useless_dir:?}"
done